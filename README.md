# RAG-агент с БД сайта neoflex

Для работы нужны langchain и langgraph, причём langchain брать версии prebuilt==1.0.4, как как в последней версии есть баг, не позволяещий нормально  работать с либой. Для дополнительной информации см. requirements.txt

Агент работает через FastAPI, а клиент к нему цепляется через прокси – телеграм-бота.

Работает так себе, так как ранжируются тексты не очень, но диалог с памятью поддерживается.

## Как запустить

Для запуска потребуется собственный OpenRouter API ключ и ключ от собственного telegram-бота. OpenRouter API ключ будет запрошен в случае необходимости. Ключ от telegram-бота необходимо положить в переменную среды "NF_HW_BOT_TOKEN".
После этого необходимо на одной и той же машине развернуть и основное приложение, и бота.
Для этого предлагается использовать `conda`, поскольку одна из частей проекта требует несовместимых с остальными версиями библиотек Python.

**Приложение и бот**

Для начала создайте отдельную среду в `conda` и установате зависимости для приложения и бота путём запуска команды в этой среде и в рабочей директории проекта: `pip install -r ./requirements.txt`.
Для разворачивания приложения необходимо воспользоваться командой в этой же среде `uvicorn main:app --reload`.
Для разворачивания бота необходимо запустить python-скрипт в этой же среде: `python tg_bot.py`.

**DB-creator**

Для создания (или пересоздания) векторной БД используется отдельный скрипт: `db_creator.py`, который необходимо запустить в отдельной `conda`-среде, установив перед этим зависимости: `pip install -r ./db_creator_requirements.txt` (находясь также, в рабочей папке проекта).

## Как использовать

Когда приложение запущено, можно обращаться к нему через интерфейс Telegram-бота, начав использование с команды `/start`. Далее общение происходит в виде диалога с нейронной сетью, см. скриншоты ниже. Команда `/reset` на данный аналогична команде `/start` – она создаёт новый `uuid` внутри бота, при помощи которого основное приложение отслеживает текущую сессию диалога с пользователем. Таким образом, при использовании команды `/reset` или `/start`, история диалога будет забыта приложением.

## Схема графа проекта
[![graph-scheme.png](https://i.postimg.cc/hGnmMgjH/graph-scheme.png)](https://postimg.cc/qNmgMP2L)

## Выполненные пункты ТЗ:

1. Собрана БД, содержащая инорфмацию по компании Neoflex, информация для которой взята с сайта https://neoflex.ru
2. Создан чат-бот с использование OpenRouter.ai, а также Ollama для поддержания свободного диалога с пользователем.
3. Создана RAG-система для генерации ответов на запросы пользователя по вопросам, касающихся организации Neoflex.
4. Реализована поддержка истории диалога, а также возможность её сброса.

## Примеры работы системы:

**Пример 1: свободный диалог**
[![free-speech.png](https://i.postimg.cc/gx34CKRV/free-speech.png)](https://postimg.cc/gx34CKRV)

**Пример 2: запрос "Какие решения на основе искусственного интеллекта создаёт Neoflex?"**
[![ai-solutions.png](https://i.postimg.cc/DS159csd/ai-solutions.png)](https://postimg.cc/DS159csd)

**Пример 3: запрос "Примеры внедрения решений компании Neoflex"**
[![integrations.png](https://i.postimg.cc/QFcS2q5g/integrations.png)](https://postimg.cc/QFcS2q5g)

**Пример 4: запрос "На какие задачи был направлен фокус компании в 2022 году?"**
[![2022-focus.png](https://i.postimg.cc/5X8phmvz/2022-focus.png)](https://postimg.cc/5X8phmvz)